<p-table 
  [value]="clientEntries" 
	[tableStyle]="{ 'min-width': '50rem' }"
	[paginator]="true"
	[rows]="5"
	[rowsPerPageOptions]="[5, 10, 20]"
	>
    <ng-template #header>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Type</th>
            <th>Balance</th>
            <th>Overdraft</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </ng-template>
    <ng-template #body let-client let-rowIndex="rowIndex">
        <tr>
            <td>{{ client.name }}</td>
            <td>{{ client.email }}</td>
            <td>{{ client.phone }}</td>
            <td>{{ client.clientType }}</td>
            <td>{{ client.bankBalance }}</td>
            <td>{{ client.outstandingLoan }}</td>
            <td>{{ client.registrationDate | date:'dd/MM/yyyy'  }}</td>
            <td>{{ client.isActive ? 'Active' : 'Inactive' }}</td>
            <td>
                <p-button 
                    icon="pi pi-pencil" 
                    severity="info" 
                    size="small"
                    (onClick)="onEdit(client, rowIndex)"
                    [outlined]="true"
                    class="mr-2"
                >
                </p-button>
                <p-button 
                    icon="pi pi-trash" 
                    severity="danger" 
                    size="small"
                    (onClick)="onDelete(rowIndex)"
                    [outlined]="true"
                >
                </p-button>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-toast></p-toast>

<p-dialog 
    header="Edit Client" 
    [(visible)]="displayEditDialog" 
    [modal]="true" 
    [style]="{width: '50vw'}"
    [draggable]="false"
    [resizable]="false"
>
    <form [formGroup]="editForm" (ngSubmit)="saveEdit()" class="p-fluid">
        <div class="edit-form-grid">
            <!-- Name Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <input
                        id="edit-name"
                        type="text"
                        pInputText
                        formControlName="name"
                    />
                    <label for="edit-name">Name <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('name')">
                        {{ getErrorMessage('name') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Email Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <input
                        id="edit-email"
                        type="email"
                        pInputText
                        formControlName="email"
                    />
                    <label for="edit-email">Email <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('email')">
                        {{ getErrorMessage('email') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Phone Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <input
                        id="edit-phone"
                        type="text"
                        pInputText
                        formControlName="phone"
                        [class.ng-invalid]="isFieldInvalid('phone')"
                        [class.ng-dirty]="isFieldInvalid('phone')"
                    />
                    <label for="edit-phone">Phone <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('phone')">
                        {{ getErrorMessage('phone') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Client Type Dropdown -->
            <p-floatlabel class="w-full md:w-56" variant="on">
                <div class="field">
                    <p-select 
                        inputId="edit-clientType" 
                        [options]="clientTypes" 
                        formControlName="clientType"
                        optionLabel="label" 
                        optionValue="value"
                        [style]="{'width':'100%'}" 
                    />
                    <label for="edit-clientType">Client Type <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('clientType')">
                        {{ getErrorMessage('clientType') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Bank Balance Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <p-inputNumber
                        inputId="edit-bankBalance"
                        formControlName="bankBalance"
                        mode="currency"
                        currency="USD"
                        locale="en-US"
                    />
                    <label for="edit-bankBalance">Bank Balance <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('bankBalance')">
                        {{ getErrorMessage('bankBalance') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Outstanding Loan Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <p-inputNumber
                        inputId="edit-outstandingLoan"
                        formControlName="outstandingLoan"
                        mode="currency"
                        currency="USD"
                        locale="en-US"
                    />
                    <label for="edit-outstandingLoan">Outstanding Loan</label>
                    <small class="error-message" *ngIf="isFieldInvalid('outstandingLoan')">
                        {{ getErrorMessage('outstandingLoan') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Registration Date Field -->
            <p-floatlabel variant="on">
                <div class="field">
                    <p-datepicker  
                        inputId="edit-registrationDate" 
                        formControlName="registrationDate"
                        showIcon 
                        iconDisplay="input"
                        dateFormat="dd/mm/yy"
                    />
                    <label for="edit-registrationDate">Registration Date <div class="r-star">*</div></label>
                    <small class="error-message" *ngIf="isFieldInvalid('registrationDate')">
                        {{ getErrorMessage('registrationDate') }}
                    </small>
                </div>
            </p-floatlabel>

            <!-- Is Active Checkbox -->
            <div class="field checkbox-field">
                <p-checkbox
                    inputId="edit-isActive"
                    formControlName="isActive"
                    [binary]="true"
                    label="Is Active"
                />
                <label for="edit-isActive">Active</label>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group" style="margin-top: 20px;">
            <p-button
                label="Save"
                icon="pi pi-check"
                type="submit"
                [disabled]="editForm.invalid"
            ></p-button>
            <p-button
                label="Cancel"
                icon="pi pi-times"
                type="button"
                severity="secondary"
                (onClick)="cancelEdit()"
            ></p-button>
        </div>
    </form>
</p-dialog>