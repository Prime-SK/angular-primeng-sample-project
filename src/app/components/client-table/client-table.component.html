<p-table 
  [value]="clientEntries" 
	[tableStyle]="{ 'min-width': '50rem' }"
	[paginator]="true"
	[rows]="5"
	[rowsPerPageOptions]="[5, 10, 20]"
	>
    <ng-template #header>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Type</th>
            <th>Balance</th>
            <th>Overdraft</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </ng-template>
    <ng-template #body let-client let-rowIndex="rowIndex">
        <tr>
            <td>{{ client.name }}</td>
            <td>{{ client.email }}</td>
            <td>{{ client.phone }}</td>
            <td>{{ client.clientType }}</td>
            <td>{{ client.bankBalance }}</td>
            <td>{{ client.outstandingLoan }}</td>
            <td>{{ client.registrationDate | date:'dd/MM/yyyy'  }}</td>
            <td>{{ client.isActive ? 'Active' : 'Inactive' }}</td>
            <td>
                <p-button 
                    icon="pi pi-pencil" 
                    severity="info" 
                    size="small"
                    (onClick)="onEdit(client, rowIndex)"
                    [outlined]="true"
                    class="mr-2"
                >
                </p-button>
                <p-button 
                    icon="pi pi-trash" 
                    severity="danger" 
                    size="small"
                    (onClick)="onDelete(rowIndex)"
                    [outlined]="true"
                >
                </p-button>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-toast></p-toast>

<p-dialog 
    header="Edit Client" 
    [(visible)]="displayEditDialog" 
    [modal]="true" 
    [style]="{width: '50vw'}"
    [draggable]="false"
    [resizable]="false"
>
    <form [formGroup]="editForm" (ngSubmit)="saveEdit()" class="p-fluid">
        <div class="edit-form-grid">
            <!-- Name Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <label for="name">Name <div class="r-star">*</div></label>
                    <input id="name" type="text" pInputText formControlName="name" />
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('name')">
                    {{ getErrorMessage('name') }}
                </small>
            </div>
            
            <!-- Email Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <label for="email">Email <div class="r-star">*</div></label>
                    <input id="email" type="email" pInputText formControlName="email" />
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('email')">
                    {{ getErrorMessage('email') }}
                </small>
            </div>
            
            <!-- Phone Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <label for="phone">Phone <div class="r-star">*</div></label>
                    <input id="phone" type="text" pInputText formControlName="phone" />
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('phone')">
                    {{ getErrorMessage('phone') }}
                </small>
            </div>
            
            <!-- Client Type Dropdown -->
            <div class="field">
                <p-floatlabel variant="on">
                    <p-select inputId="clientType" [options]="clientTypes" formControlName="clientType" optionLabel="label"
                        optionValue="value" />
                    <label for="clientType">Client Type <div class="r-star">*</div></label>
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('clientType')">
                    {{ getErrorMessage('clientType') }}
                </small>
            </div>
            
            <!-- Bank Balance Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <p-inputNumber inputId="bankBalance" formControlName="bankBalance" mode="currency" currency="USD"
                        locale="en-US" />
                    <label for="bankBalance">Bank Balance <div class="r-star">*</div></label>
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('bankBalance')">
                    {{ getErrorMessage('bankBalance') }}
                </small>
            </div>
            
            <!-- Outstanding Loan Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <p-inputNumber inputId="outstandingLoan" formControlName="outstandingLoan" mode="currency" currency="USD"
                        locale="en-US" />
                    <label for="outstandingLoan">Outstanding Loan</label>
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('outstandingLoan')">
                    {{ getErrorMessage('outstandingLoan') }}
                </small>
            </div>
            
            <!-- Registration Date Field -->
            <div class="field">
                <p-floatlabel variant="on">
                    <p-datepicker inputId="registrationDate" formControlName="registrationDate" showIcon iconDisplay="input"
                        dateFormat="dd/mm/yy" />
                    <label for="registrationDate">Registration Date <div class="r-star">*</div></label>
                </p-floatlabel>
                <small class="error-message" *ngIf="isFieldInvalid('registrationDate')">
                    {{ getErrorMessage('registrationDate') }}
                </small>
            </div>
            
            <!-- Is Active Checkbox -->
            <div class="field checkbox-field">
                <label for="isActive" style="margin: 0 10px 0 0;">Active</label>
                <p-checkbox inputId="isActive" formControlName="isActive" [binary]="true" label="Is Active" />
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group" style="margin-top: 20px;">
            <p-button
                label="Save"
                icon="pi pi-check"
                type="submit"
                [disabled]="editForm.invalid"
            ></p-button>
            <p-button
                label="Cancel"
                icon="pi pi-times"
                type="button"
                severity="secondary"
                (onClick)="cancelEdit()"
            ></p-button>
        </div>
    </form>
</p-dialog>